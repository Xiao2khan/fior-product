<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/admin/main}">
<head>
    <meta charset="UTF-8">
    <title>Danh má»¥c</title>
</head>
<body>
<div layout:fragment="admin-content">
    <h3 th:text="${category.id} != null ? 'Edit Category' : 'Create Category'"></h3>

    <form th:action="${category.id} != null ? @{'/admin/categories/edit/' + ${category.id}} : @{/admin/categories/create}"
          method="post"
          th:object="${category}">

        <!-- ðŸ”¹ Máº·c Ä‘á»‹nh tiáº¿ng Viá»‡t -->
        <div class="mb-3">
            <label class="form-label">TÃªn</label>
            <input type="text" class="form-control" th:field="*{name}" required>
            <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">MÃ´ táº£</label>
            <textarea class="form-control" rows="3" th:field="*{description}"></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
        </div>

        <div id="lang-container">
            <th:block th:if="${translations != null}">
                <th:block th:each="t, iStat : ${translations}">
                        <div class="border p-3 rounded mb-3 bg-light position-relative lang-block">
                            <button type="button" class="btn-close position-absolute top-0 end-0 m-2"
                                    aria-label="Close"></button>
                            <h5 class="mb-3">English (en)</h5>
                            <input type="hidden" th:name="'translations[' + ${iStat.index} + '].language'" th:value="${t.language}">
                            <div class="mb-3">
                                <label class="form-label">Name (en)</label>
                                <input type="text" class="form-control"
                                       th:name="'translations[' + ${iStat.index} + '].name'"
                                       th:value="${t.name}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description (en)</label>
                                <textarea class="form-control"
                                          th:name="'translations[' + ${iStat.index} + '].description'"
                                          rows="3"
                                          th:text="${t.description}"></textarea>
                            </div>
                        </div>
                </th:block>
            </th:block>
        </div>

        <div class="d-flex justify-content-end mb-3">
            <button type="button" class="btn btn-outline-primary" id="add-lang-btn">
                <i class="fa fa-plus me-1"></i> ThÃªm tiáº¿ng Anh (en)
            </button>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-primary" type="submit"><i class="fa fa-save me-1"></i>LÆ°u</button>
            <a class="btn btn-secondary" th:href="@{/admin/categories}">Trá»Ÿ láº¡i</a>
        </div>
    </form>
</div>

<th:block layout:fragment="scripts">
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const addLangBtn = document.getElementById("add-lang-btn");
            const langContainer = document.getElementById("lang-container");

            langContainer.querySelectorAll(".lang-block .btn-close").forEach(btn => {
                btn.addEventListener("click", () => {
                    btn.closest(".lang-block").remove();
                    addLangBtn.style.display = "block";
                });
            });

            let enBlockExists = !!langContainer.querySelector("input[value='en']");
            if (enBlockExists) addLangBtn.style.display = "none";

            addLangBtn.addEventListener("click", () => {
                if (langContainer.querySelector("input[value='en']")) return;

                const enBlock = document.createElement("div");
                enBlock.classList.add("border", "p-3", "rounded", "mb-3", "bg-light", "position-relative", "lang-block");
                enBlock.innerHTML = `
                    <button type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Close"></button>
                    <h5 class="mb-3">English (en)</h5>
                    <input type="hidden" name="translations[0].language" value="en">
                    <div class="mb-3">
                        <label class="form-label">TÃªn (en)</label>
                        <input type="text" class="form-control" name="translations[0].name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">MÃ´ táº£ (en)</label>
                        <textarea class="form-control" name="translations[0].description" rows="3"></textarea>
                    </div>
                `;
                langContainer.appendChild(enBlock);
                addLangBtn.style.display = "none";

                enBlock.querySelector(".btn-close").addEventListener("click", () => {
                    enBlock.remove();
                    addLangBtn.style.display = "block";
                });
            });
        });
    </script>
</th:block>

</body>
</html>


